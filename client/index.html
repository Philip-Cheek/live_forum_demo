<html ng-app = "mean_forum">
	<head>
		<title>MEAN Live Forum Demonstration</title> 
		<script type = "text/javascript" src = "https://ajax.googleapis.com/ajax/libs/angularjs/1.4.9/angular.min.js"></script>
		<link rel = "stylesheet" type = "text/css" href = "../static/styles/style.css"/>
		<script>
			var Filthy_Forum = angular.module('mean_forum', ['ngRoute'], function() {});


			Filthy_Forum.config(function ($routeProvider) {
	      		$routeProvider
		        	.when('/',{
		            	templateUrl: '../static/partials/enter.html'
	        		})
	        		.when('/forum',{
	            		templateUrl: '../static/partials/forum.html'
	        		})
	        		.otherwise({
	          			redirectTo: '/'
	        		
	        		});
	    	});

			Filthy_Forum.factory('FilthyFactory', function($http) {
				var factory = {}

				factory.get_emails = function(callback){
					$http.get('/email_list').success(function(output){
						var email_list = output;
						callback(email_list)
					})
				};

				factory.create = function(info, callback){
					$http.post('/create_user', info).success(function(output){
						callback();
					}
				});

				factory.login = function(info, callback).success(function(output){
					$http.post('/create_user', info).success(function(output){
						callback(output.status);
					}
				}

				return factory
			});
			
			Filthy_Forum.directive('exists', function () {
    			return {
        			restrict: 'A',
        			require: 'ngModel',
        			link: function (scope, elm, attrs, ctrl) {
	            		ctrl.$parsers.unshift(function (viewValue) {
	                		var duplicate = scope[attrs.exists];

	                		if (scope.duplicate.indexOf(viewValue) !== -1) {
	                    		ctrl.$setValidity('already_exists', false);
	                    		return undefined;
	                		} else {
	                    		ctrl.$setValidity('already_exists', true);
	                    		return viewValue;
	                		}
	            		});
        			}
    			};
			});

			Filthy_Forum.directive('match', function($parse) {
  				return {
    				require: 'ngModel',
    				link: function(scope, elem, attrs, ctrl) {
		      			scope.$watch(function() {        
		        			return $parse(attrs.match)(scope) === ctrl.$modelValue;
		      			}, function(currentValue) {
		        			ctrl.$setValidity('mismatch', currentValue);
		      			});
    				}
  				};
			});

			Filthy_Forum.controller('Login_Controller', function ($scope, FilthyFactory){
				$scope.head = "Welcome";
				$scope.log_error;

				$scope.user = {};
				$scope.strong = /^(?=.*[A-Z])(?=.*[a-z])(?=.*\d).*$/;
				$scope.emails = [];

				FilthyFactory.get_email = function(data){
					$scope.emails = data;
				}

				$scope.submitReg = function(isValid) {
					if (isValid) { 
						FilthyFactory.create_user($scope.user, function(){
							$scope.head = $scope.user.f_name;
							$scope.user.p_word = "";
							$scope.user.c_word = "";
							$location.path('/forum')
						});
					}
				};

				$scope.logReg = function(isValid) {
					if (isValid) { 
						FilthyFactory.log_in($scope.user, function(){
							if (!status){
								$scope.log_error = "Log In incorrect."
							}else{
								$scope.head = $scope.user.f_name;
								$scope.user.p_word = "";
								$scope.user.c_word = "";
								$location.path('/forum')
							}
						});
					}
				};
	        });

			var log = [document.getElementById("log_tab"), document.getElementById("log_box")];
			var reg = [document.getElementById("reg_tab"), document.getElementById("reg_box")];
			
			var "log_state" = true;
			
			log[0].EventListener('click', function(){
				if (!log_state){
					log[1].style.display = 'block'
					reg[1].style.display = 'none';

					log_state = true;
				}
			});

			reg[0].EventListener('click', function(){
				if (log_state){
					reg[1].style.display = 'block'
					log[1].style.display = 'none';

					log_state = false;
				}
			});
		</script>
	</head>
	<body>
		<div id = "filthy_head" ng-controller="Login-Controller">
			<h1>{{head}}</h1>
		</div> 

		<div ng-view = ""> 
